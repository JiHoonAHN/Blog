<!DOCTYPE html><html lang="en"><head><title>JiHoonAHN-Blog - iOS Developer</title><meta name="twitter:title" content="JiHoonAHN-Blog - iOS Developer"/><meta name="og:title" content="JiHoonAHN-Blog - iOS Developer"/><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" type="image/x-icon" href="/images/Icon/icon.svg"/><script src="https://kit.fontawesome.com/662f6d0c39.js" crossorigin="anonymous"></script><script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><link rel="stylesheet" href="/theme/default/default_style.css"/><link rel="stylesheet" href="/theme/header/header_style.css"/><link rel="stylesheet" href="/theme/footer/footer_style.css"/><link rel="stylesheet" href="/theme/home/home_style.css"/><link rel="stylesheet" href="/theme/post/post_style.css"/><link rel="stylesheet" href="/theme/tag/tag_style.css"/><link rel="stylesheet" href="/theme/tagDetail/tagDetail_style.css"/><link rel="stylesheet" href="/theme/page/debate/debate_style.css"/><link rel="stylesheet" href="/theme/page/about/about_style.css"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet"/></head><body><div class="home-template has-cover"><div class="viewport"><header id="blog-head" class="blog-head outer"><nav class="blog-head-inner inner"><div class="blog-head-brand"><a class="blog-head-logo" href="/"><img src="/images/logo/logo.svg"/></a><div class="blog-head-brand-wrapper"><button class="blog-search"><i class="fa-solid fa-magnifying-glass"></i></button><button class="blog-menu"><i class="fa-regular fa-bars"></i></button></div></div><div class="blog-head-menu"><ul class="nav"><li class="nav-item"><a href="/">Home</a></li><li class="nav-item"><a href="/debate">Debate</a></li><li class="nav-item"><a href="/about">About</a></li></ul></div><div class="blog-head-actions"><button class="blog-search"><i class="fa-solid fa-magnifying-glass"></i></button></div></nav><script src="/js/Header/header-menu.js" defer></script><script src="/js/Header/header-scroll.js" defer></script></header><article><header class="site-post-head"><div class="site-post-head-image"><img src="/images/Image/posts/14.jpg"/></div></header><div class="site-post-head-title"><h1>Building a real-world iOS app (Part 2): Separating application into frameworks</h1><section class="site-post-full-meta"><time>2019.03.17</time><span class="date-divider">|</span><a href="/tags/debate">Debate. </a></section></div><div class="site-post-body"><div><p>In this part of the series we'll overview how to properly setup the application.</p><h1>Creating Frameworks</h1><p>As we talked in the <a href="/posts/2019-03-11-aerogami_series_part_1">previous part</a>, we'll begin the creation of the project by creating 3 separate frameworks inside our XCode project (<code>TravelKit</code>, <code>TravelDataKit</code>, <code>TravelFeatureKit</code>). An article on <a href="https://www.raywenderlich.com/5109-creating-a-framework-for-ios">raywenderlich.com</a> has a thorough explanation of the whole process.</p><p>After creating frameworks, project navigator should look something like in the picture below.</p><img src="/images/aerogami-tutorial/part2/project_frameworks.png" alt="Frameworks in the Project Navigator" width="300"/><h1>Setting up CocoaPods</h1><p>We'll be using <a href="https://cocoapods.org">CocoaPods</a> for managing dependencies in our project. Although setting up CocoaPods is fairly straightforward, there can be some difficulties when having local frameworks involved. The configuration is defined in <code>Podfile</code> which is located in the root folder of the project.</p><p><code>Podfile</code> will be configured in a way that is clean and clear so it would not get messy when number of dependencies in the project grow. Essentially, we'll define the reusable pods at the top of the file and group different groups of pods that can be reused for different frameworks.</p><p>The part of <code>Podfile</code> that defines pods of <code>TravelKit</code>.</p><pre><code>platform :ios, '<span class="number">11.0</span>'
use_frameworks!
inhibit_all_warnings!

deployment_target = '<span class="number">11.0</span>'

workspace '<span class="type">TravelApplication</span>.<span class="property">xcworkspace</span>'

#Versions
<span class="property">$swinjectVersion</span> =                    '~&gt; <span class="number">2.4</span>'
<span class="property">$swiftDateVersion</span> =                   '~&gt; <span class="number">5.0</span>'
&lt;...&gt;

def shared_TravelKit_pods
    pod '<span class="type">RxSwift</span>',                    <span class="property">$rxSwiftVersion</span>
    pod '<span class="type">SwiftDate</span>',                  <span class="property">$swiftDateVersion</span>
end

target '<span class="type">TravelKit</span>' <span class="keyword">do</span>
    project '<span class="type">TravelKit</span>.<span class="property">xcodeproj</span>'
    platform :ios, deployment_target

    shared_TravelKit_pods

  target '<span class="type">TravelKitTests</span>' <span class="keyword">do</span>
    project '<span class="type">TravelKit</span>.<span class="property">xcodeproj</span>'
    inherit! :search_paths

    shared_testing_pods
  end
end
&lt;...&gt;
</code></pre><p>These different shared pods should be assembled and used of the actual application target.</p><pre><code>&lt;...&gt;
def shared_Apps_pods
  shared_TravelKit_pods
  &lt;...&gt;
end

target '<span class="type">TravelApplication</span>' <span class="keyword">do</span>
    project '<span class="type">TravelApplication</span>.<span class="property">xcodeproj</span>'
    platform :ios, deployment_target
    shared_Apps_pods
end
&lt;...&gt;
</code></pre><p>The full <a href="https://github.com/staskus/aerogami-ios/blob/master/Podfile">Podfile</a> can be found on <code>GitHub</code> as the rest of the project.</p><h1>Dependency Injection</h1><p>I prefer to think early about the way dependencies will be managed inside the application. Although dependency injection can be achieved without 3rd party libraries, for this project we'll use <a href="https://github.com/Swinject/Swinject">Swinject</a> that has easy to use interfaces for managing dependencies.</p><p>Our classes will use <code>initializer injection</code> thus all the dependencies will be given through the initializer. The classes will be initialized in assemblies. Assembly is a <code>Swinject</code> class which has access to a container of already injected dependencies and provides a way to register new dependencies.</p><p>For example, this is how the assembly of the <code>Feed</code> that displays the list of flights might looks like:</p><pre><code><span class="keyword">import</span> Foundation
<span class="keyword">import</span> Swinject
<span class="keyword">import</span> TravelKit

<span class="keyword">public class</span> FeedAssembly: <span class="type">Assembly</span> {

    <span class="keyword">public init</span>() {
    }

    <span class="keyword">public func</span> assemble(container: <span class="type">Container</span>) {
        container.<span class="call">register</span>(<span class="type">FeedConfigurator</span>.<span class="keyword">self</span>) { r <span class="keyword">in</span>
            <span class="type">FeedConfigurator</span>(
                regionRepository: r.<span class="call">resolve</span>(<span class="type">RegionRepository</span>.<span class="keyword">self</span>)!,
                tripRepository: r.<span class="call">resolve</span>(<span class="type">TripRepository</span>.<span class="keyword">self</span>)!,
                airportRepository: r.<span class="call">resolve</span>(<span class="type">AirportRepository</span>.<span class="keyword">self</span>)!,
                tripImageRepository: r.<span class="call">resolve</span>(<span class="type">TripImageRepository</span>.<span class="keyword">self</span>)!
                )
            }
            .<span class="call">initCompleted</span> { (resolver, feedConfigurator) <span class="keyword">in</span>
                feedConfigurator.<span class="property">bookTripConfigurator</span> = resolver.<span class="call">resolve</span>(<span class="type">BookTripConfigurator</span>.<span class="keyword">self</span>)!
            }
            .<span class="call">inObjectScope</span>(.<span class="dotAccess">container</span>)
    }
}
</code></pre><p>Here, we inject <code>FeedConfigurator</code> class. It is essentially a factory class for the whole <code>Feed</code> feature and its view. <code>Swinject</code> automatically passes the dependencies such as <code>RegionRepository</code> or <code>TripRepository</code>. We expect these dependencies to be injected in another assembly so we can resolve it here.</p><p>Our application will have <code>AssemblerFactory</code> that will contain all the different assemblies of the application and create them during initialization process.</p><pre><code><span class="keyword">import</span> Foundation
<span class="keyword">import</span> Swinject
<span class="keyword">import</span> TravelFeatureKit
<span class="keyword">import</span> TravelDataKit

<span class="keyword">class</span> AssemblerFactory {

    <span class="keyword">func</span> create() -&gt; <span class="type">Assembler</span> {
        <span class="keyword">let</span> assemblies: [<span class="type">Assembly</span>] = [
            <span class="type">ApplicationAssembly</span>(),
            <span class="type">RegionRepositoryAssembly</span>(),
            <span class="type">TripRepositoryAssembly</span>(),
            <span class="type">AirportRepositoryAssembly</span>(),

            <span class="type">MainAssembly</span>(),
            <span class="type">FavoritesAssembly</span>(),
            <span class="type">FeedAssembly</span>(),
            <span class="type">BookTripAssembly</span>(),
            <span class="type">BookURLRepositoryAssembly</span>(affiliateId: <span class="type">Constants</span>.<span class="property">affiliateId</span>)
        ]

        <span class="keyword">let</span> assembler = <span class="type">Assembler</span>(assemblies)

        <span class="keyword">return</span> assembler
    }
}
</code></pre><p>We use this assembly to create the first <code>ViewController</code> of the application and set it as <code>rootViewController</code>. See <a href="https://github.com/staskus/aerogami-ios/blob/master/TravelApplication/Application/ApplicationLoader.swift">ApplicationLoader</a>.</p><pre><code>   <span class="keyword">self</span>.<span class="property">assembler</span> = <span class="type">AssemblerFactory</span>().<span class="call">create</span>()
  <span class="keyword">let</span> rootConfigurator = assembler.<span class="property">resolver</span>.<span class="call">resolve</span>(<span class="type">MainConfigurator</span>.<span class="keyword">self</span>)!
  <span class="keyword">let</span> rootViewController = rootConfigurator.<span class="call">createViewController</span>()
  window?.<span class="property">rootViewController</span> = rootViewController
  window?.<span class="call">makeKeyAndVisible</span>()
</code></pre><p>In the following parts of the series we'll be creating classes for fetching and presenting data that will use assemblies for injecting dependencies. We'll see more closely how having proper dependency injection allows code to be more reusable, safe and testable.</p></div></div></article><footer class="site-footer outer"><div class="inner"><section class="copyright"><a href="https://github.com/Pelagornis">Pelagornis</a> © 2022</section><nav class="site-footer-nav"><ul class="nav"><li class="nav-list-item"><a href="/">Home</a></li><li class="nav-list-item"><a href="/debate">Debate</a></li><li class="nav-list-item"><a href="/about">About</a></li></ul></nav><ul class="site-footer-social-list"><li class="site-footer-social-list-item"><a href="https://github.com/JiHoonAHN"><i class="fab fa-github-square"></i></a></li><li class="site-footer-social-list-item"><a href="mailto:ahnjh1028@naver.com"><i class="fas fa-envelope-open-text"></i></a></li></ul></div></footer></div></div></body></html>